### ( 2023-04-01 ) ( 1680343768 ) ### DO NOT EDIT ### auto-generated file / patchset by <appliance-builder/enhanced> ###
--- ./Makefile.orig	1970-01-01 00:00:00.000000000 +0000
+++ ./Makefile	1970-01-01 00:00:00.000000000 +0000
@@ -1,6 +1,6 @@
 #Makefile autogenerated by RcB2
-prefix = /usr/local
-bindir = $(prefix)/bin
+#prefix = /usr/local
+#bindir = $(prefix)/bin
 
 PROG = jobflow
 SRCS =  sblist.c \
@@ -28,8 +28,8 @@
 	$(MAKE) -f $(MAKEFILE) clean && $(MAKE) -f $(MAKEFILE) all
 
 install: $(PROG)
-	install -d $(DESTDIR)/$(bindir)
-	install -D -m 755 $(PROG) $(DESTDIR)/$(bindir)/
+	install -d $(DESTDIR)$(PREFIX)/bin
+	install $(PROG) $(DESTDIR)$(PREFIX)/bin
 
 src: $(SRCS)
 	$(CC) $(CPPFLAGS_N) $(CPPFLAGS) $(CFLAGS_N) $(CFLAGS) -o $(PROG) $^ $(LDFLAGS_N) $(LDFLAGS) $(LIBS)
--- ./jobflow.c.orig	1970-01-01 00:00:00.000000000 +0000
+++ ./jobflow.c	1970-01-01 00:00:00.000000000 +0000
@@ -58,17 +58,12 @@
 
 #include <sys/resource.h>
 
-#if defined(__GLIBC__) && (__GLIBC__ < 3) && (__GLIBC_MINOR__ < 13)
-/* http://repo.or.cz/w/glibc.git/commitdiff/c08fb0d7bba4015078406b28d3906ccc5fda9d5a ,
- * http://repo.or.cz/w/glibc.git/commitdiff/052fa7b33ef5deeb4987e5264cf397b3161d8a01 */
-#warning to use prlimit() you have to use musl libc 0.8.4+ or glibc 2.13+
 static int prlimit(int pid, ...) {
 	(void) pid;
 	dprintf(2, "prlimit() not implemented on this system\n");
 	errno = EINVAL;
 	return -1;
 }
-#endif
 
 #include <sys/time.h>
 
@@ -874,7 +869,7 @@
 	size_t left = 0, bytes_read = 0;
 	const size_t chunksize = prog_state.bulk_bytes ? prog_state.bulk_bytes : 16*1024;
 
-	char *mem = mmap(NULL, chunksize*2, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANON, -1, 0);
+	char *mem = mmap(NULL, chunksize*2, PROT_READ | PROT_WRITE, MAP_PRIVATE | 0x1000, -1, 0);
 	char *buf1 = mem;
 	char *buf2 = mem+chunksize;
 	char *in, *inbuf;
